# 要件定義書

## プロジェクト概要

### プロジェクト名

Discord 用 Bot2 型

### プロジェクトの目的

現在運用中の Bot で使用している SDK のバージョンがサポート終了しているため早急な置き換えが必要な状況。
同時により安定かつ高機能な Bot を開発し導入することでサービスの向上を目指す。

### プロジェクトの範囲

- Bot 本体
- 動作環境

## 機能要件

### 機能一覧

#### 基本機能

- Bot の応答チャンネル指定機能
- Bot 機能の有効化、無効化機能
- Bot の死活確認用応答機能
- Bot 起動時の通知機能
- 連続したリクエストに対する制御、警告

#### ロール管理機能

- ロールの作成
- ロールの削除
- 作成したロールの保存機能
- ロールの上限設定
- 作成済みロールの一覧表示
- ロールを付与されているユーザーの一覧表示
- ロールの付与、取り消し
- 使用されていないロールの自動削除機能

#### 制御権限管理機能

- サーバー管理者以外の操作制限機能

## 機能詳細

### 基本機能

#### Bot の応答チャンネル指定機能

入力
bot に応答を行わせたいチャンネルで、”setup”コマンドをメンションで送信する。

出力
メンションのあったチャンネルでのみ応答するよう設定する。

エラー
メンションしたユーザーに管理者権限がない。
設定したチャンネルで発言権が無い。

備考
すでにチャンネルが設定済みの場合は上書きする。

#### Bot 機能の有効化、無効化機能

入力
”watch”,”stop”メンションを行う。
出力
“watch”で応答機能を有効化する。
“stop”で応答機能を無効化する。
エラー
DB の更新失敗
備考
死活監視は無効化時でも実行する。

#### Bot の死活確認用応答機能

入力
“ポリポリ”とメンションを行う。
出力
DM で“ポリポリ”と送信する。

#### Bot 起動時の通知機能

入力
Bot が起動する。
出力
導入しているサーバーの管理者に DM 送信を行う。

#### 連続したリクエストに対する制御、警告

入力
前回のコマンド入力後から 3 秒以内にコマンドを送信する。
出力
エラーメッセージをスレッドで返信する。

### ロール管理機能

#### ロールの作成

入力
“role create {ロール名}|{ロール名 1},{ロール名 2}...”とメンションを送信する。
出力
Bot がロールを作成する。
作成したロールをスレッドで送信する。
エラー
管理者権限がないユーザーはエラー
合計で 10 個以上の場合はエラーとして作成しない。

#### ロールの削除

入力
“role delete {ロール名}|{ロール名 1},{ロール名 2}...”とメンションを送信する。
出力
Bot がロールを削除する。
削除したロールをスレッドで送信する。
エラー
管理者権限がないユーザーはエラー
備考
存在しないロールは無視

#### 作成済みロールの一覧表示

入力
“role list”とメンションを送信する。
出力
Bot が管理しているロールの一覧を表示する。

#### ロールを付与されているユーザーの一覧表示

入力
“role user {ロール名}”とメンションを送信する。
出力
Bot が管理しているロールの一覧を表示する。

#### ロールの付与

入力
“role add {ロール名}|{ロール名 1},{ロール名 2}...”とメンションを送信する。
出力
メンションを送信したユーザーにメンションに含まれるロールを付与する。
付与したロールをスレッドで送信する。
備考
存在しないロールは無視する。

#### ロールの取り消し

入力
“role remove {ロール名}|{ロール名 1},{ロール名 2}...”とメンションを送信する。
出力
メンションを送信したユーザーからメンションに含まれるロールを取り消す。
取り消したロールをスレッドで送信する。
備考
存在しないロールは無視する。

#### 作成したロールの保存機能

作成されたロールを DB に保存する。
ロールの上限設定
10 個以上のロールを作成しない。

#### 使用されていないロールの自動削除機能

- 作成から 1 週間以上経過したロールの内、使用しているユーザーがいないロールを削除する。

#### 制御権限管理機能

- サーバー管理者以外の操作制限機能
- サーバー管理者以外にはロール一覧表示、付与、取り消し、死活確認以外行えない。

---

## 非機能要件

### 性能要件

1 秒以内の応答

### 可用性要件

できる限り安定して動作すること

### セキュリティ要件

- GCP のセキュリティ機能
- リポジトリに暗号鍵を保存しない。

### 運用・保守要件

- 毎日午前 4 時に再起動

---

### システム構成

- GCE e2-micro
- firestore
